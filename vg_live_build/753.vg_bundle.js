"use strict";(self.webpackChunkcustom_vf_nextjs=self.webpackChunkcustom_vf_nextjs||[]).push([[753],{11753:(n,t,e)=>{e.r(t),e.d(t,{default:()=>j});var o=e(42982),i=e(92167),r=e(15861),a=e(70885),l=e(64687),u=e.n(l),c=e(11194),s=e(67294),v=e(1721),g=e.n(v),f=e(13068),d=e(84962),p=e(17828),b=e(82280),m=e(79352),h=e(57479),y=e(60155),k=e(48676),w=e(30381),O=e.n(w),x=e(68650),N=e(73711),D=e(70231),I=s.createElement;function S(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function _(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?S(Object(e),!0).forEach((function(t){(0,i.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):S(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}const j=function(n){var t,e,i,l,v,w,S=(0,k.useRuntime)(),j=S.runtime,E=S.confirmedBucket,P=S.setRuntime,T=S.pushChatNotice,C=((0,h.F)().getColor,s.useState({})),J=(0,a.Z)(C,2),Z=J[0],R=J[1],G=s.useState(null),M=(0,a.Z)(G,2),q=M[0],A=M[1],B=s.useState("init"),F=(0,a.Z)(B,2),L=F[0],Y=F[1],K=(null==j||null===(t=j.variables)||void 0===t||null===(t=t.vapiConfig)||void 0===t?void 0:t.PUBLIC_API_KEY)||(null==Z||null===(e=Z.vapiConfig)||void 0===e?void 0:e.PUBLIC_API_KEY);function U(){return(U=(0,r.Z)(u().mark((function t(){var e,o,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat((0,c.MC)({region:"voiceglow-eu"===E?"eu":"na"}),"/public/users/").concat(null===(e=n.agentData)||void 0===e?void 0:e.ownerID)).then((function(n){return n.json()}));case 2:o=t.sent,R(o.data),i=new(g())(K),A(i);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return s.useEffect((function(){if(K){var n=new(g())(K);A(n)}}),[K]),s.useEffect((function(){if(q)return q.on("call-start",(function(){Y("ongoing"),P((function(n){return _(_({},n),{},{callOngoing:!0})}))})),q.on("speech-end",(function(){})),q.on("speech-start",(function(){})),q.on("call-end",(0,r.Z)(u().mark((function n(){var t,e,i,r,a,l,c,s,v;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Y("init"),P((function(n){return _(_({},n),{},{callOngoing:!1})})),a=(0,x.getFirestore)(N.l2,E),l={from:"bot",messages:[{from:"bot",type:"info:primary",item:{payload:"The call has ended."},ts:O()().unix()}],ts:O()().unix()},n.next=6,(0,x.getDoc)((0,x.doc)(a,"voiceglow/".concat(null==j||null===(t=j.variables)||void 0===t?void 0:t.ID,"/convos/").concat(j.userID,"/convo/JSON_STRING")));case 6:return c=n.sent,s=JSON.parse((null===(e=c.data())||void 0===e?void 0:e.convoTurns_JSON_STRING)||"[]"),"bot"===(null===(i=s[s.length-1])||void 0===i?void 0:i.from)?null===(v=s[s.length-1])||void 0===v||v.messages.push(l.messages[0]):s.push(l),n.next=11,(0,x.setDoc)((0,x.doc)(a,"voiceglow/".concat(null==j||null===(r=j.variables)||void 0===r?void 0:r.ID,"/convos/").concat(j.userID,"/convo/JSON_STRING")),{convoTurns_JSON_STRING:JSON.stringify((0,o.Z)(s))});case 11:case"end":return n.stop()}}),n)})))),q.on("volume-level",(function(n){})),q.on("message",function(){var n=(0,r.Z)(u().mark((function n(t){var e,o,i;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("conversation-update"!==t.type){n.next=6;break}if(null==(e=t.conversation.flatMap((function(n){try{JSON.parse(n.content);return[]}catch(t){return!n.content||"assistant"!==(null==n?void 0:n.role)&&"user"!==n.role?[]:{from:"assistant"===n.role?"bot":"human",messages:[{from:"assistant"===n.role?"bot":"human",type:"text",item:{payload:{message:n.content}},ts:O()().unix()}],ts:O()().unix()}}})))||!e.length){n.next=6;break}return i=(0,x.getFirestore)(N.l2,E),n.next=6,(0,x.setDoc)((0,x.doc)(i,"voiceglow/".concat(null==j||null===(o=j.variables)||void 0===o?void 0:o.ID,"/convos/").concat(j.userID,"/convo/JSON_STRING")),{convoTurns_JSON_STRING:JSON.stringify(e)});case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),q.on("error",(function(t){if(n.test)try{var e,o,i=(null==t||null===(e=t.error)||void 0===e?void 0:e.message)||(null==t||null===(o=t.error)||void 0===o?void 0:o.msg);P((function(n){return _(_({},n),{},{callOngoing:!1})})),Y("init"),i&&T(i,"fail",5e3)}catch(t){T("Error occured please check console","fail",3e3)}})),function(){q.stop(),P((function(n){return _(_({},n),{},{callOngoing:!1})}))}}),[q]),s.useEffect((function(){!function(){U.apply(this,arguments)}()}),[]),K?I(d.E.div,{key:"vg-voice--container",initial:{opacity:1,bottom:"init"===L?"-30%":"0%",height:"35%"},animate:{opacity:1,bottom:0,height:"init"===L?"40%":"35%"},exit:{opacity:1,bottom:"init"===L?"-35%":"0%",height:"35%"},transition:{type:"spring",damping:20,stiffness:100,mass:.5},className:" vg-py-5 vg-h-full vg-flex vg-flex-col vg-gap-0 vg-justify-center vg-items-center vg-absolute vg-left-0 vg-w-full vg-bg-background/50 vg-backdrop-blur vg-z-[100] vg-px-20 vg-mx-auto vg-text-center vg-border-t vg-border-foreground-100 vg-voice--container"},I(p.M,null,"init"===L?I(d.E.div,{className:" vg-mb-4 ",layout:!0,key:"vg-voice--question_".concat(null===(i=n.agentData)||void 0===i?void 0:i.ID)},I(b.Z,{className:" vg-text-large vg-font-bold vg-leading-6 vg-voice--question"},(null===(l=n.agentData)||void 0===l||null===(l=l.ui)||void 0===l||null===(l=l.voice)||void 0===l?void 0:l.question)||"Would you like to talk in realtime with an AI agent?")):null,I(d.E.button,{key:"vg-voice--yes-please_".concat(null===(v=n.agentData)||void 0===v?void 0:v.ID),layout:!0,animate:{scale:"init"===L?1:"starting"===L?1.05:"ongoing"===L?1.1:1},whileHover:{scale:1.1},className:" vg-border vg-border-foreground-300 ".concat("init"===L?" vg-bg-background-500 ":"starting"===L?" vg-bg-background-600 ":"ongoing"===L?" vg-bg-danger-500 vg-text-danger-50 ":" vg-bg-background-500 "," vg-mb-5 vg-rounded-full vg-w-20 vg-h-20 vg-p-5 vg-font-bold vg-transition-colors vg-voice--yes-button"),onClick:function(){var t;"init"!==L?q.isMuted()?(q.setMuted(!1),Y("ongoing")):(q.setMuted(!0),Y("muted")):(Y("starting"),q.start(null===(t=n.agentData)||void 0===t||null===(t=t.vapi)||void 0===t?void 0:t.id))}},"starting"===L?I(f.Z,{className:" vg-w-full vg-h-full "}):null,"init"===L?I(D.uYL,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "}):null,"ongoing"===L?I(m.xEs,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "}):null,"muted"===L?I(m._v3,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "}):null),I(d.E.button,{key:"vg-voice--no-thanks_".concat(null===(w=n.agentData)||void 0===w?void 0:w.ID),layout:!0,className:" vg-border vg-border-foreground-100 vg-w-8 vg-h-8 vg-font-normal vg-opacity-80 vg-rounded-full vg-p-1 vg-voice--no-button",onClick:function(){q&&q.stop(),n.onNoThanks&&n.onNoThanks()}},I(y.bjh,{className:" vg-w-full vg-h-full vg-flex-shrink-0 "})))):null}}}]);